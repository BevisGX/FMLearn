cmake_minimum_required(VERSION 3.10)
project(FMLearn)

set(CMAKE_CXX_STANDARD 11)
set(CMAKE_C_FLAGS -m64)
set(CMAKE_CXX_FLAGS -m64)

set(BUILD_UNIT_TEST true)


include_directories(
        "${PROJECT_SOURCE_DIR}"
        "${PROJECT_SOURCE_DIR}/src/common"
        "${PROJECT_SOURCE_DIR}/src/data"
        "${PROJECT_SOURCE_DIR}/src/core"
        "${PROJECT_SOURCE_DIR}/src/c_api"
        "${PROJECT_BINARY_DIR}"
        "${PROJECT_SOURCE_DIR}/gtest/include"
)


link_directories(
        "${PROJECT_BINARY_DIR}/src/common"
        "${PROJECT_BINARY_DIR}/src/data"
        "${PROJECT_BINARY_DIR}/src/core"
        "${PROJECT_BINARY_DIR}/src/c_api"
)


add_subdirectory(gtest)
add_subdirectory(src/common)
add_subdirectory(src/core)
add_subdirectory(src/data)
add_subdirectory(src/c_api)

add_library(fm_learn SHARED
        src/c_api/c_api.cpp
        src/c_api/c_api_error.cpp
        src/core/model.cpp
        src/core/fm_model.cpp
        src/data/data.cpp
        src/common/log.cpp)

# Set properties
set_target_properties(fm_learn PROPERTIES OUTPUT_NAME "fm_learn")
set_target_properties(fm_learn PROPERTIES CLEAN_DIRECT_OUTPUT 1)

# Scripts
if (WIN32)
    FILE(COPY "${PROJECT_SOURCE_DIR}/scripts/run_test.bat"
            DESTINATION ${CMAKE_BINARY_DIR})
else ()
    FILE(COPY "${PROJECT_SOURCE_DIR}/scripts/run_test.sh"
            DESTINATION ${CMAKE_BINARY_DIR})
endif ()

install(TARGETS fm_learn DESTINATION ${CMAKE_BINARY_DIR})